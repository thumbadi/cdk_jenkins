CREATE OR REPLACE VIEW mfr.mfr_bank_file_vw
AS SELECT row_number() OVER () AS id,
    'C'::text AS recordoperation,
    'M'::text AS organizationcode,
    'MFR'::text || md.mfr_id AS payeeid,
    'MFR'::text || md.mfr_id AS organizationidentifier,
    md.mfr_name AS organizationname,
    md.mfr_name AS organizationlegalname,
    '00-0000000'::text AS organizationtin,
    'EIN'::text AS organizationtintype,
    'P'::text AS "Profit / Nonprofit",
    NULL::text AS organizationnpi,
        CASE
            WHEN mpd.mtf_pymt_routing_num IS NOT NULL THEN 'EFT'::text
            ELSE NULL::text
        END AS paymentmode,
    mpd.mtf_pymt_routing_num AS routingtransitnumber,
    mpd.mtf_pymt_acct_num AS accountnumber,
    initcap(mpd.mtf_pymt_acct_type::text) AS accounttype,
    NULL::text AS effectivestartdate,
    NULL::text AS effectiveenddate,
    NULL::text AS addresscode,
    NULL::text AS addressline1,
    NULL::text AS addressline2,
    NULL::text AS cityname,
    NULL::text AS state,
    NULL::text AS postalcode,
    'AO'::text AS contactcode,
    mpd.mtf_pymt_contact_first_name AS contactfirstname,
    mpd.mtf_pymt_contact_last_name AS contactlastname,
    NULL::text AS contacttitle,
    NULL::text AS contactphone,
    NULL::text AS contactfax,
    NULL::text AS contactotherphone,
    NULL::text AS contactemail
   FROM shared.mfr_dtl md
     JOIN mfr.mfr_profile mp ON md.mfr_id = mp.mfr_id
     LEFT JOIN mfr.mfr_pymt_dtl mpd ON mp.mfr_profile_id = mpd.mfr_profile_id AND mpd.mfr_pymt_dtl_id = (( SELECT max(mpd2.mfr_pymt_dtl_id) AS max
           FROM mfr.mfr_pymt_dtl mpd2
          WHERE mp.mfr_profile_id = mpd2.mfr_profile_id))
     JOIN mfr.mfr_cert_dtl mcd ON mp.mfr_profile_id = mcd.mfr_profile_id AND mcd.mfr_cert_dtl_id = (( SELECT max(mcd2.mfr_cert_dtl_id) AS max
           FROM mfr.mfr_cert_dtl mcd2
          WHERE mp.mfr_profile_id = mcd2.mfr_profile_id))
  WHERE mcd.mfr_cert_yn = true;

-------------------------------------

INSERT INTO mfr.mfr_bank_file_vw (id,recordoperation,organizationcode,payeeid,organizationidentifier,organizationname,organizationlegalname,organizationtin,organizationtintype,"Profit / Nonprofit",organizationnpi,paymentmode,routingtransitnumber,accountnumber,accounttype,effectivestartdate,effectiveenddate,addresscode,addressline1,addressline2,cityname,state,postalcode,contactcode,contactfirstname,contactlastname,contacttitle,contactphone,contactfax,contactotherphone,contactemail) VALUES
	 (1,'C','M','MFR14','MFR14','Janssen Biotech, Inc.','Janssen Biotech, Inc.','00-0000000','EIN','P',NULL,'EFT','044000024','00038372937','Savings',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'AO','John','Sparks',NULL,NULL,NULL,NULL,NULL),
	 (2,'C','M','MFR10','MFR10','Bristol Myers Squibb','Bristol Myers Squibb','00-0000000','EIN','P',NULL,'EFT','021000322','1000347837','Checking',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'AO','Jane','Doe',NULL,NULL,NULL,NULL,NULL);
